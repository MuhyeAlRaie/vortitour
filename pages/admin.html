<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - VORTITOUR</title>
    <meta name="description" content="Administrative dashboard for VORTITOUR platform management">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">
    
    <!-- Configuration -->
    <script src="/config.js"></script>
    
    <style>
        .admin-sidebar {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .admin-content {
            min-height: 100vh;
            background-color: #f8f9fa;
        }
        
        .stat-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
        }
        
        .activity-item {
            border-left: 3px solid #007bff;
            padding-left: 15px;
            margin-bottom: 15px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #007bff, #6610f2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .status-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }
        
        .admin-nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin-bottom: 0.25rem;
            transition: all 0.2s;
        }
        
        .admin-nav-link:hover,
        .admin-nav-link.active {
            color: white;
            background-color: rgba(255, 255, 255, 0.1);
            text-decoration: none;
        }
    </style>
</head>
<body>
    <!-- Loading Spinner -->
    <div id="loading-spinner" class="loading-overlay">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <div class="mt-3">Loading Admin Dashboard...</div>
    </div>

    <div class="container-fluid p-0">
        <div class="row g-0">
            <!-- Sidebar -->
            <div class="col-lg-2 admin-sidebar">
                <div class="p-3">
                    <!-- Logo -->
                    <div class="text-center mb-4">
                        <h4 class="text-white fw-bold">
                            <i class="bi bi-shield-check me-2"></i>
                            ADMIN
                        </h4>
                        <small class="text-white-50">VORTITOUR Platform</small>
                    </div>
                    
                    <!-- Navigation -->
                    <nav class="nav flex-column">
                        <a href="#overview" class="admin-nav-link active" data-section="overview">
                            <i class="bi bi-speedometer2 me-2"></i>
                            <span data-i18n="admin.overview">Overview</span>
                        </a>
                        <a href="#users" class="admin-nav-link" data-section="users">
                            <i class="bi bi-people me-2"></i>
                            <span data-i18n="admin.users">Users</span>
                        </a>
                        <a href="#organizations" class="admin-nav-link" data-section="organizations">
                            <i class="bi bi-building me-2"></i>
                            <span data-i18n="admin.organizations">Organizations</span>
                        </a>
                        <a href="#tours" class="admin-nav-link" data-section="tours">
                            <i class="bi bi-collection me-2"></i>
                            <span data-i18n="admin.tours">Tours</span>
                        </a>
                        <a href="#analytics" class="admin-nav-link" data-section="analytics">
                            <i class="bi bi-graph-up me-2"></i>
                            <span data-i18n="admin.analytics">Analytics</span>
                        </a>
                        <a href="#system" class="admin-nav-link" data-section="system">
                            <i class="bi bi-gear me-2"></i>
                            <span data-i18n="admin.system">System</span>
                        </a>
                        <a href="#logs" class="admin-nav-link" data-section="logs">
                            <i class="bi bi-journal-text me-2"></i>
                            <span data-i18n="admin.logs">Logs</span>
                        </a>
                    </nav>
                    
                    <!-- User Info -->
                    <div class="mt-auto pt-4">
                        <div class="text-center">
                            <div class="user-avatar mx-auto mb-2" id="admin-avatar">A</div>
                            <div class="text-white small" id="admin-name">Admin User</div>
                            <div class="text-white-50 small" id="admin-role">Super Admin</div>
                        </div>
                        <div class="mt-3">
                            <a href="../index.html" class="btn btn-outline-light btn-sm w-100">
                                <i class="bi bi-box-arrow-left me-1"></i>
                                <span data-i18n="admin.backToSite">Back to Site</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-lg-10 admin-content">
                <!-- Header -->
                <div class="bg-white border-bottom p-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="mb-0" id="section-title">Platform Overview</h5>
                            <small class="text-muted" id="section-subtitle">Monitor and manage your VORTITOUR platform</small>
                        </div>
                        <div class="d-flex align-items-center gap-3">
                            <div class="language-toggle" id="language-toggle">
                                <i class="bi bi-translate me-1"></i>
                                <span id="current-language">EN</span>
                            </div>
                            <div class="dropdown">
                                <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="bi bi-three-dots-vertical"></i>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><a class="dropdown-item" href="#" onclick="refreshData()">
                                        <i class="bi bi-arrow-clockwise me-2"></i>
                                        <span data-i18n="admin.refresh">Refresh Data</span>
                                    </a></li>
                                    <li><a class="dropdown-item" href="#" onclick="exportData()">
                                        <i class="bi bi-download me-2"></i>
                                        <span data-i18n="admin.export">Export Data</span>
                                    </a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="#" onclick="showSettings()">
                                        <i class="bi bi-gear me-2"></i>
                                        <span data-i18n="admin.settings">Settings</span>
                                    </a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Content Sections -->
                <div class="p-4">
                    <!-- Overview Section -->
                    <div id="overview-section" class="admin-section">
                        <!-- Stats Cards -->
                        <div class="row mb-4">
                            <div class="col-lg-3 col-md-6 mb-3">
                                <div class="card stat-card bg-primary text-white">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <h3 class="h2 mb-0" id="total-users">-</h3>
                                                <p class="mb-0" data-i18n="admin.totalUsers">Total Users</p>
                                            </div>
                                            <i class="bi bi-people fs-1 opacity-75"></i>
                                        </div>
                                        <div class="mt-2">
                                            <small class="opacity-75">
                                                <i class="bi bi-arrow-up me-1"></i>
                                                +12% from last month
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-3 col-md-6 mb-3">
                                <div class="card stat-card bg-success text-white">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <h3 class="h2 mb-0" id="total-organizations">-</h3>
                                                <p class="mb-0" data-i18n="admin.totalOrganizations">Organizations</p>
                                            </div>
                                            <i class="bi bi-building fs-1 opacity-75"></i>
                                        </div>
                                        <div class="mt-2">
                                            <small class="opacity-75">
                                                <i class="bi bi-arrow-up me-1"></i>
                                                +8% from last month
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-3 col-md-6 mb-3">
                                <div class="card stat-card bg-info text-white">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <h3 class="h2 mb-0" id="total-tours-admin">-</h3>
                                                <p class="mb-0" data-i18n="admin.totalTours">Total Tours</p>
                                            </div>
                                            <i class="bi bi-collection fs-1 opacity-75"></i>
                                        </div>
                                        <div class="mt-2">
                                            <small class="opacity-75">
                                                <i class="bi bi-arrow-up me-1"></i>
                                                +25% from last month
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-3 col-md-6 mb-3">
                                <div class="card stat-card bg-warning text-white">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <h3 class="h2 mb-0" id="total-views-admin">-</h3>
                                                <p class="mb-0" data-i18n="admin.totalViews">Total Views</p>
                                            </div>
                                            <i class="bi bi-eye fs-1 opacity-75"></i>
                                        </div>
                                        <div class="mt-2">
                                            <small class="opacity-75">
                                                <i class="bi bi-arrow-up me-1"></i>
                                                +18% from last month
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Charts Row -->
                        <div class="row mb-4">
                            <div class="col-lg-8 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0" data-i18n="admin.platformGrowth">Platform Growth</h6>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="growth-chart" height="100"></canvas>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-4 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0" data-i18n="admin.userDistribution">User Distribution</h6>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="user-distribution-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Recent Activity -->
                        <div class="row">
                            <div class="col-lg-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0" data-i18n="admin.recentActivity">Recent Activity</h6>
                                    </div>
                                    <div class="card-body" id="recent-activity">
                                        <!-- Activity items will be loaded here -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0" data-i18n="admin.systemHealth">System Health</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row text-center">
                                            <div class="col-4">
                                                <div class="mb-2">
                                                    <i class="bi bi-server fs-2 text-success"></i>
                                                </div>
                                                <h6 class="text-success">99.9%</h6>
                                                <small class="text-muted" data-i18n="admin.uptime">Uptime</small>
                                            </div>
                                            <div class="col-4">
                                                <div class="mb-2">
                                                    <i class="bi bi-speedometer2 fs-2 text-info"></i>
                                                </div>
                                                <h6 class="text-info">1.2s</h6>
                                                <small class="text-muted" data-i18n="admin.avgResponse">Avg Response</small>
                                            </div>
                                            <div class="col-4">
                                                <div class="mb-2">
                                                    <i class="bi bi-hdd fs-2 text-warning"></i>
                                                </div>
                                                <h6 class="text-warning">78%</h6>
                                                <small class="text-muted" data-i18n="admin.storage">Storage</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Users Section -->
                    <div id="users-section" class="admin-section d-none">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5 data-i18n="admin.userManagement">User Management</h5>
                            <button class="btn btn-primary" onclick="showAddUserModal()">
                                <i class="bi bi-plus me-1"></i>
                                <span data-i18n="admin.addUser">Add User</span>
                            </button>
                        </div>
                        
                        <!-- Filters -->
                        <div class="card mb-4">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3">
                                        <input type="text" class="form-control" placeholder="Search users..." id="user-search">
                                    </div>
                                    <div class="col-md-3">
                                        <select class="form-select" id="user-role-filter">
                                            <option value="">All Roles</option>
                                            <option value="admin">Admin</option>
                                            <option value="user">User</option>
                                            <option value="viewer">Viewer</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <select class="form-select" id="user-status-filter">
                                            <option value="">All Status</option>
                                            <option value="active">Active</option>
                                            <option value="inactive">Inactive</option>
                                            <option value="suspended">Suspended</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <button class="btn btn-outline-secondary w-100" onclick="filterUsers()">
                                            <i class="bi bi-funnel me-1"></i>
                                            Filter
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Users Table -->
                        <div class="card">
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover" id="users-table">
                                        <thead>
                                            <tr>
                                                <th>User</th>
                                                <th>Email</th>
                                                <th>Organization</th>
                                                <th>Role</th>
                                                <th>Status</th>
                                                <th>Last Login</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Users will be loaded here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Organizations Section -->
                    <div id="organizations-section" class="admin-section d-none">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5 data-i18n="admin.organizationManagement">Organization Management</h5>
                            <button class="btn btn-primary" onclick="showAddOrgModal()">
                                <i class="bi bi-plus me-1"></i>
                                <span data-i18n="admin.addOrganization">Add Organization</span>
                            </button>
                        </div>
                        
                        <!-- Organizations Grid -->
                        <div class="row" id="organizations-grid">
                            <!-- Organizations will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- Tours Section -->
                    <div id="tours-section" class="admin-section d-none">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5 data-i18n="admin.tourManagement">Tour Management</h5>
                            <div class="btn-group">
                                <button class="btn btn-outline-secondary" onclick="bulkAction('publish')">
                                    <i class="bi bi-globe me-1"></i>
                                    Bulk Publish
                                </button>
                                <button class="btn btn-outline-secondary" onclick="bulkAction('unpublish')">
                                    <i class="bi bi-eye-slash me-1"></i>
                                    Bulk Unpublish
                                </button>
                                <button class="btn btn-outline-danger" onclick="bulkAction('delete')">
                                    <i class="bi bi-trash me-1"></i>
                                    Bulk Delete
                                </button>
                            </div>
                        </div>
                        
                        <!-- Tours Table -->
                        <div class="card">
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover" id="tours-table">
                                        <thead>
                                            <tr>
                                                <th>
                                                    <input type="checkbox" id="select-all-tours">
                                                </th>
                                                <th>Tour</th>
                                                <th>Organization</th>
                                                <th>Creator</th>
                                                <th>Status</th>
                                                <th>Views</th>
                                                <th>Created</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Tours will be loaded here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Analytics Section -->
                    <div id="analytics-section" class="admin-section d-none">
                        <h5 class="mb-4" data-i18n="admin.platformAnalytics">Platform Analytics</h5>
                        
                        <!-- Analytics content will be similar to the analytics page but with admin perspective -->
                        <div class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body text-center py-5">
                                        <i class="bi bi-graph-up fs-1 text-muted mb-3"></i>
                                        <h6 class="text-muted">Platform Analytics</h6>
                                        <p class="text-muted">Comprehensive analytics dashboard for platform-wide insights</p>
                                        <a href="analytics.html" class="btn btn-primary">
                                            <i class="bi bi-arrow-right me-1"></i>
                                            View Full Analytics
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- System Section -->
                    <div id="system-section" class="admin-section d-none">
                        <h5 class="mb-4" data-i18n="admin.systemSettings">System Settings</h5>
                        
                        <div class="row">
                            <div class="col-lg-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0" data-i18n="admin.generalSettings">General Settings</h6>
                                    </div>
                                    <div class="card-body">
                                        <form id="general-settings-form">
                                            <div class="mb-3">
                                                <label class="form-label" data-i18n="admin.platformName">Platform Name</label>
                                                <input type="text" class="form-control" value="VORTITOUR">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label" data-i18n="admin.defaultLanguage">Default Language</label>
                                                <select class="form-select">
                                                    <option value="en">English</option>
                                                    <option value="ar">Arabic</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="maintenance-mode">
                                                    <label class="form-check-label" for="maintenance-mode" data-i18n="admin.maintenanceMode">
                                                        Maintenance Mode
                                                    </label>
                                                </div>
                                            </div>
                                            <button type="submit" class="btn btn-primary">
                                                <span data-i18n="admin.saveSettings">Save Settings</span>
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0" data-i18n="admin.storageSettings">Storage Settings</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label">Cloudinary Cloud Name</label>
                                            <input type="text" class="form-control" placeholder="your-cloud-name">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Max File Size (MB)</label>
                                            <input type="number" class="form-control" value="50">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Storage Usage</label>
                                            <div class="progress">
                                                <div class="progress-bar" style="width: 78%">78%</div>
                                            </div>
                                            <small class="text-muted">7.8 GB of 10 GB used</small>
                                        </div>
                                        <button class="btn btn-primary">
                                            <span data-i18n="admin.updateStorage">Update Storage</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Logs Section -->
                    <div id="logs-section" class="admin-section d-none">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5 data-i18n="admin.systemLogs">System Logs</h5>
                            <div class="btn-group">
                                <button class="btn btn-outline-secondary" onclick="refreshLogs()">
                                    <i class="bi bi-arrow-clockwise me-1"></i>
                                    Refresh
                                </button>
                                <button class="btn btn-outline-secondary" onclick="clearLogs()">
                                    <i class="bi bi-trash me-1"></i>
                                    Clear Logs
                                </button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-body">
                                <div class="log-viewer" style="height: 400px; overflow-y: auto; background: #1e1e1e; color: #fff; padding: 1rem; border-radius: 8px; font-family: 'Courier New', monospace;">
                                    <div class="log-entry">
                                        <span class="text-success">[2024-01-15 10:30:15]</span> 
                                        <span class="text-info">[INFO]</span> 
                                        User authentication successful for user@example.com
                                    </div>
                                    <div class="log-entry">
                                        <span class="text-success">[2024-01-15 10:29:45]</span> 
                                        <span class="text-warning">[WARN]</span> 
                                        High memory usage detected: 85%
                                    </div>
                                    <div class="log-entry">
                                        <span class="text-success">[2024-01-15 10:28:30]</span> 
                                        <span class="text-info">[INFO]</span> 
                                        New tour created: "Modern Office Space"
                                    </div>
                                    <div class="log-entry">
                                        <span class="text-success">[2024-01-15 10:27:12]</span> 
                                        <span class="text-danger">[ERROR]</span> 
                                        Failed to upload image: connection timeout
                                    </div>
                                    <div class="log-entry">
                                        <span class="text-success">[2024-01-15 10:26:05]</span> 
                                        <span class="text-info">[INFO]</span> 
                                        Database backup completed successfully
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Application Scripts -->
    <script src="/js/i18n.js"></script>
    <script src="/js/supabase-client.js"></script>
    <script src="/js/app.js"></script>
    
    <script>
        // Admin Dashboard
        class AdminDashboard {
            constructor() {
                this.currentSection = 'overview';
                this.charts = {};
                this.data = {
                    users: [],
                    organizations: [],
                    tours: [],
                    analytics: {}
                };
            }

            async init() {
                console.log('Initializing admin dashboard...');
                
                // Check admin authentication
                if (!this.checkAdminAccess()) {
                    window.location.href = 'login.html';
                    return;
                }

                // Load initial data
                await this.loadDashboardData();
                
                // Setup navigation
                this.setupNavigation();
                
                // Initialize charts
                this.initializeCharts();
                
                // Setup event listeners
                this.setupEventListeners();
            }

            checkAdminAccess() {
                // Check if user is authenticated and has admin role
                if (!window.VortitourSupabase.isAuthenticated()) {
                    return false;
                }

                // In a real implementation, check user role from database
                // For demo purposes, assume authenticated user is admin
                return true;
            }

            async loadDashboardData() {
                try {
                    // Load sample data for demo
                    this.data = {
                        users: this.generateSampleUsers(),
                        organizations: this.generateSampleOrganizations(),
                        tours: this.generateSampleTours(),
                        analytics: this.generateSampleAnalytics()
                    };

                    this.updateOverviewStats();
                    this.updateRecentActivity();

                } catch (error) {
                    console.error('Error loading dashboard data:', error);
                }
            }

            generateSampleUsers() {
                return [
                    { id: 1, name: 'John Doe', email: 'john@example.com', organization: 'Tech Corp', role: 'admin', status: 'active', lastLogin: '2024-01-15' },
                    { id: 2, name: 'Jane Smith', email: 'jane@example.com', organization: 'Design Studio', role: 'user', status: 'active', lastLogin: '2024-01-14' },
                    { id: 3, name: 'Mike Johnson', email: 'mike@example.com', organization: 'Real Estate Co', role: 'user', status: 'inactive', lastLogin: '2024-01-10' }
                ];
            }

            generateSampleOrganizations() {
                return [
                    { id: 1, name: 'Tech Corp', users: 15, tours: 8, plan: 'Pro', status: 'active' },
                    { id: 2, name: 'Design Studio', users: 8, tours: 12, plan: 'Business', status: 'active' },
                    { id: 3, name: 'Real Estate Co', users: 25, tours: 35, plan: 'Enterprise', status: 'active' }
                ];
            }

            generateSampleTours() {
                return [
                    { id: 1, title: 'Modern Apartment', organization: 'Real Estate Co', creator: 'John Doe', status: 'published', views: 1250, created: '2024-01-10' },
                    { id: 2, title: 'Office Space', organization: 'Tech Corp', creator: 'Jane Smith', status: 'draft', views: 0, created: '2024-01-12' },
                    { id: 3, title: 'Retail Store', organization: 'Design Studio', creator: 'Mike Johnson', status: 'published', views: 890, created: '2024-01-08' }
                ];
            }

            generateSampleAnalytics() {
                return {
                    totalUsers: 48,
                    totalOrganizations: 12,
                    totalTours: 156,
                    totalViews: 25430
                };
            }

            updateOverviewStats() {
                document.getElementById('total-users').textContent = this.data.analytics.totalUsers;
                document.getElementById('total-organizations').textContent = this.data.analytics.totalOrganizations;
                document.getElementById('total-tours-admin').textContent = this.data.analytics.totalTours;
                document.getElementById('total-views-admin').textContent = this.data.analytics.totalViews.toLocaleString();
            }

            updateRecentActivity() {
                const activities = [
                    { type: 'user_registered', message: 'New user registered: john@example.com', time: '5 minutes ago', icon: 'person-plus', color: 'success' },
                    { type: 'tour_published', message: 'Tour "Modern Apartment" was published', time: '15 minutes ago', icon: 'globe', color: 'info' },
                    { type: 'organization_created', message: 'New organization "Tech Startup" created', time: '1 hour ago', icon: 'building', color: 'primary' },
                    { type: 'system_backup', message: 'System backup completed successfully', time: '2 hours ago', icon: 'shield-check', color: 'success' }
                ];

                const container = document.getElementById('recent-activity');
                container.innerHTML = activities.map(activity => `
                    <div class="activity-item">
                        <div class="d-flex align-items-start">
                            <div class="me-3">
                                <i class="bi bi-${activity.icon} text-${activity.color}"></i>
                            </div>
                            <div class="flex-grow-1">
                                <div class="small">${activity.message}</div>
                                <div class="text-muted" style="font-size: 0.75rem;">${activity.time}</div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            setupNavigation() {
                document.querySelectorAll('.admin-nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = link.dataset.section;
                        this.showSection(section);
                    });
                });
            }

            showSection(sectionName) {
                // Hide all sections
                document.querySelectorAll('.admin-section').forEach(section => {
                    section.classList.add('d-none');
                });

                // Show selected section
                document.getElementById(`${sectionName}-section`).classList.remove('d-none');

                // Update navigation
                document.querySelectorAll('.admin-nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');

                // Update header
                this.updateSectionHeader(sectionName);

                // Load section data
                this.loadSectionData(sectionName);

                this.currentSection = sectionName;
            }

            updateSectionHeader(sectionName) {
                const titles = {
                    overview: 'Platform Overview',
                    users: 'User Management',
                    organizations: 'Organization Management',
                    tours: 'Tour Management',
                    analytics: 'Platform Analytics',
                    system: 'System Settings',
                    logs: 'System Logs'
                };

                const subtitles = {
                    overview: 'Monitor and manage your VORTITOUR platform',
                    users: 'Manage user accounts and permissions',
                    organizations: 'Manage organizations and subscriptions',
                    tours: 'Manage virtual tours across all organizations',
                    analytics: 'View platform-wide analytics and insights',
                    system: 'Configure system settings and preferences',
                    logs: 'View system logs and error reports'
                };

                document.getElementById('section-title').textContent = titles[sectionName];
                document.getElementById('section-subtitle').textContent = subtitles[sectionName];
            }

            loadSectionData(sectionName) {
                switch (sectionName) {
                    case 'users':
                        this.loadUsersData();
                        break;
                    case 'organizations':
                        this.loadOrganizationsData();
                        break;
                    case 'tours':
                        this.loadToursData();
                        break;
                    case 'analytics':
                        this.loadAnalyticsData();
                        break;
                    case 'system':
                        this.loadSystemData();
                        break;
                    case 'logs':
                        this.loadLogsData();
                        break;
                }
            }

            loadUsersData() {
                const tbody = document.querySelector('#users-table tbody');
                tbody.innerHTML = this.data.users.map(user => `
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="user-avatar me-2">${user.name.charAt(0)}</div>
                                <div>
                                    <div class="fw-medium">${user.name}</div>
                                </div>
                            </div>
                        </td>
                        <td>${user.email}</td>
                        <td>${user.organization}</td>
                        <td><span class="badge bg-secondary">${user.role}</span></td>
                        <td><span class="badge bg-${user.status === 'active' ? 'success' : 'warning'}">${user.status}</span></td>
                        <td>${user.lastLogin}</td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="editUser(${user.id})">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteUser(${user.id})">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }

            loadOrganizationsData() {
                const container = document.getElementById('organizations-grid');
                container.innerHTML = this.data.organizations.map(org => `
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <h6 class="card-title">${org.name}</h6>
                                    <span class="badge bg-${org.status === 'active' ? 'success' : 'warning'}">${org.status}</span>
                                </div>
                                <div class="row text-center mb-3">
                                    <div class="col-4">
                                        <div class="h5 mb-0">${org.users}</div>
                                        <small class="text-muted">Users</small>
                                    </div>
                                    <div class="col-4">
                                        <div class="h5 mb-0">${org.tours}</div>
                                        <small class="text-muted">Tours</small>
                                    </div>
                                    <div class="col-4">
                                        <div class="h5 mb-0">${org.plan}</div>
                                        <small class="text-muted">Plan</small>
                                    </div>
                                </div>
                                <div class="btn-group w-100">
                                    <button class="btn btn-outline-primary btn-sm" onclick="editOrganization(${org.id})">
                                        <i class="bi bi-pencil me-1"></i>Edit
                                    </button>
                                    <button class="btn btn-outline-info btn-sm" onclick="viewOrganization(${org.id})">
                                        <i class="bi bi-eye me-1"></i>View
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            loadToursData() {
                const tbody = document.querySelector('#tours-table tbody');
                tbody.innerHTML = this.data.tours.map(tour => `
                    <tr>
                        <td><input type="checkbox" class="tour-checkbox" value="${tour.id}"></td>
                        <td>
                            <div class="fw-medium">${tour.title}</div>
                        </td>
                        <td>${tour.organization}</td>
                        <td>${tour.creator}</td>
                        <td><span class="badge bg-${tour.status === 'published' ? 'success' : 'secondary'}">${tour.status}</span></td>
                        <td>${tour.views.toLocaleString()}</td>
                        <td>${tour.created}</td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="editTour(${tour.id})">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn btn-outline-info" onclick="viewTour(${tour.id})">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteTour(${tour.id})">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }

            loadAnalyticsData() {
                // Analytics section content is handled separately
            }

            loadSystemData() {
                // System settings are already in the HTML
            }

            loadLogsData() {
                // Logs are already in the HTML for demo
            }

            initializeCharts() {
                // Growth Chart
                const growthCtx = document.getElementById('growth-chart').getContext('2d');
                this.charts.growth = new Chart(growthCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [
                            {
                                label: 'Users',
                                data: [12, 19, 25, 32, 38, 48],
                                borderColor: '#007bff',
                                backgroundColor: 'rgba(0, 123, 255, 0.1)'
                            },
                            {
                                label: 'Tours',
                                data: [8, 15, 28, 45, 78, 156],
                                borderColor: '#28a745',
                                backgroundColor: 'rgba(40, 167, 69, 0.1)'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });

                // User Distribution Chart
                const userDistCtx = document.getElementById('user-distribution-chart').getContext('2d');
                this.charts.userDistribution = new Chart(userDistCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Admin', 'User', 'Viewer'],
                        datasets: [{
                            data: [5, 35, 8],
                            backgroundColor: ['#dc3545', '#007bff', '#6c757d']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true
                    }
                });
            }

            setupEventListeners() {
                // Select all tours checkbox
                document.getElementById('select-all-tours').addEventListener('change', (e) => {
                    document.querySelectorAll('.tour-checkbox').forEach(checkbox => {
                        checkbox.checked = e.target.checked;
                    });
                });

                // General settings form
                document.getElementById('general-settings-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    window.VortitourApp.showSuccess('Settings saved successfully');
                });
            }
        }

        // Global functions for admin actions
        window.refreshData = function() {
            console.log('Refreshing data...');
            window.VortitourApp.showInfo('Data refreshed');
        };

        window.exportData = function() {
            console.log('Exporting data...');
            window.VortitourApp.showInfo('Export functionality coming soon');
        };

        window.showSettings = function() {
            console.log('Showing settings...');
        };

        window.showAddUserModal = function() {
            window.VortitourApp.showInfo('Add user modal coming soon');
        };

        window.showAddOrgModal = function() {
            window.VortitourApp.showInfo('Add organization modal coming soon');
        };

        window.editUser = function(userId) {
            console.log('Editing user:', userId);
            window.VortitourApp.showInfo('Edit user functionality coming soon');
        };

        window.deleteUser = function(userId) {
            if (confirm('Are you sure you want to delete this user?')) {
                console.log('Deleting user:', userId);
                window.VortitourApp.showSuccess('User deleted successfully');
            }
        };

        window.editOrganization = function(orgId) {
            console.log('Editing organization:', orgId);
            window.VortitourApp.showInfo('Edit organization functionality coming soon');
        };

        window.viewOrganization = function(orgId) {
            console.log('Viewing organization:', orgId);
            window.VortitourApp.showInfo('View organization functionality coming soon');
        };

        window.editTour = function(tourId) {
            console.log('Editing tour:', tourId);
            window.location.href = `editor.html?tour=${tourId}`;
        };

        window.viewTour = function(tourId) {
            console.log('Viewing tour:', tourId);
            window.open(`viewer.html?tour=${tourId}`, '_blank');
        };

        window.deleteTour = function(tourId) {
            if (confirm('Are you sure you want to delete this tour?')) {
                console.log('Deleting tour:', tourId);
                window.VortitourApp.showSuccess('Tour deleted successfully');
            }
        };

        window.bulkAction = function(action) {
            const selectedTours = Array.from(document.querySelectorAll('.tour-checkbox:checked')).map(cb => cb.value);
            if (selectedTours.length === 0) {
                window.VortitourApp.showError('Please select tours first');
                return;
            }
            
            if (confirm(`Are you sure you want to ${action} ${selectedTours.length} tours?`)) {
                console.log(`Bulk ${action} for tours:`, selectedTours);
                window.VortitourApp.showSuccess(`Bulk ${action} completed successfully`);
            }
        };

        window.filterUsers = function() {
            console.log('Filtering users...');
            window.VortitourApp.showInfo('User filtering functionality coming soon');
        };

        window.refreshLogs = function() {
            console.log('Refreshing logs...');
            window.VortitourApp.showInfo('Logs refreshed');
        };

        window.clearLogs = function() {
            if (confirm('Are you sure you want to clear all logs?')) {
                console.log('Clearing logs...');
                window.VortitourApp.showSuccess('Logs cleared successfully');
            }
        };

        // Initialize admin dashboard
        let adminDashboard;
        document.addEventListener('DOMContentLoaded', async function() {
            // Hide loading spinner
            document.getElementById('loading-spinner').style.display = 'none';
            
            // Initialize i18n
            if (window.VortitourI18n) {
                window.VortitourI18n.init();
            }
            
            // Initialize Supabase
            await window.VortitourSupabase.init();
            
            // Initialize app
            if (window.VortitourApp) {
                await window.VortitourApp.init();
            }
            
            // Initialize admin dashboard
            adminDashboard = new AdminDashboard();
            await adminDashboard.init();
        });
    </script>
</body>
</html>

